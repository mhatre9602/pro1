<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sai Prasad Restaurant</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <style>
      .container {
        width: 500px;
        margin: auto;
        border: 1px solid black;
        padding-top: 10px;
      }
      .btn {
        margin-bottom: 5px;
      }
      .heading {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="container" id="mainContainer">
      <label for="price" class="form-label">Price</label>
      <input type="text" class="form-control" id="price" />

      <label for="dish" class="form-label">Dish</label>
      <input type="text" class="form-control" id="dish" />

      <label for="tableSelect" class="form-label">Table Number</label>
      <select name="table" id="tableSelect">
        <option value="Table1">Table1</option>
        <option value="Table2">Table2</option>
        <option value="Table3">Table3</option>
      </select>
      <div id="addBtn">
        <input
          type="submit"
          class="btn btn-primary"
          value="Generate Order"
          onclick="createOrders()"
        />
      </div>
    </div>
    <div class="heading" id="headID">
      <h1 id="t1">Table1</h1>
      <h1 id="t2">Table2</h1>
      <h1 id="t3">Table3</h1>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      let parent1 = document.getElementById("t1");
      let parent2 = document.getElementById("t2");
      let parent3 = document.getElementById("t3");

      window.addEventListener("DOMContentLoaded", () => {
        axios
          .get(
            "https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate"
          )
          .then((response) => {
            console.log(response.data);
            for (let i = 0; i < response.data.length; i++) {
              showOrders(response.data[i]);
            }
          })
          .catch((err) => console.log(err));
      });

      function showOrders(orders) {
        let priceOfDish = document.getElementById("price").value;
        let dishName = document.getElementById("dish").value;
        let TableNumber = orders.TableNumber;
        let orderObj = { priceOfDish, dishName, TableNumber };

        let deleteOrder = document.createElement("input");
        deleteOrder.type = "button";
        deleteOrder.value = "Cancel";
        deleteOrder.className = "btn btn-danger btn-sm";

        if (TableNumber == "Table1") {
          let para = document.createElement("h4");
          para.textContent = orders.priceOfDish + " " + orders.dishName;

          parent1.appendChild(para);
          para.appendChild(deleteOrder);
          deleteOrder.onclick = () => {
            let ID = orders._id;
            console.log(ID);
            axios
              .delete(
                `https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate/${ID}`
              )
              .then((res) => {
                parent1.removeChild(para);
              })
              .catch((err) => console.log(err));
          };
        }
        if (TableNumber == "Table2") {
          let para = document.createElement("h4");
          para.textContent = orders.priceOfDish + " " + orders.dishName;

          parent2.appendChild(para);
          para.appendChild(deleteOrder);
          deleteOrder.onclick = () => {
            let ID = orders._id;
            console.log(ID);
            axios
              .delete(
                `https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate/${ID}`
              )
              .then((res) => {
                parent2.removeChild(para);
              })
              .catch((err) => console.log(err));
          };
        }
        if (TableNumber == "Table3") {
          let para = document.createElement("h4");
          para.textContent = orders.priceOfDish + " " + orders.dishName;

          parent3.appendChild(para);
          para.appendChild(deleteOrder);
          deleteOrder.onclick = () => {
            let ID = orders._id;
            console.log(ID);
            axios
              .delete(
                `https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate/${ID}`
              )
              .then((res) => {
                parent3.removeChild(para);
              })
              .catch((err) => console.log(err));
          };
        }
      }
      function createOrders() {
        let priceOfDish = document.getElementById("price").value;
        let dishName = document.getElementById("dish").value;
        let TableNumber = $("#tableSelect").val();
        let orderObj = { priceOfDish, dishName, TableNumber };

        if (TableNumber == "Table1") {
          axios
            .post(
              "https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate",
              orderObj
            )
            .then((res) => {
              location.reload();
              console.log(res);
            })
            .catch((err) => console.log(err));
        }

        if (TableNumber == "Table2") {
          axios
            .post(
              "https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate",
              orderObj
            )
            .then((res) => {
              location.reload();
              console.log(res);
            })
            .catch((err) => console.log(err));
        }

        if (TableNumber == "Table3") {
          axios
            .post(
              "https://crudcrud.com/api/b8a0fb00988342729904254b72be71bd/orderCreate",
              orderObj
            )
            .then((res) => {
              location.reload();
              console.log(res);
            })
            .catch((err) => console.log(err));
        }
        return false;
      }
    </script>
  </body>
</html>
